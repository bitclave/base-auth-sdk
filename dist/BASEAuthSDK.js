!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("BASEAuthSDK",[],e):"object"==typeof exports?exports.BASEAuthSDK=e():t.BASEAuthSDK=e()}(window,function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";function r(t,e,i,r){this.id=t,this.methodName=e,this.args=i,this.resolve=r}i.r(e),r.prototype.send=function(t,e){t.postMessage({rpcCall:{id:this.id,methodName:this.methodName,args:this.args}},e)},r.prototype.respond=function(t,e,i){t.postMessage({rpcCall:{id:this.id,methodName:this.methodName,args:this.args,value:i}},e)};function n(t,e){this._targetWindow=t,this._targetOrigin=e,this._calls={},this._listeners={},this._currentCallId=1,"*"!==this._targetOrigin&&"/"!==this._targetOrigin[this._targetOrigin.length-1]&&(this._targetOrigin+="/"),window.addEventListener("message",this._onMessage.bind(this))}n.prototype.call=function(t,e){return new Promise(function(i,n){const s=this._currentCallId++;this._calls[s]=new r(s,t,e,i),this._calls[s].send(this._targetWindow,this._targetOrigin)}.bind(this))},n.prototype.listen=function(t,e){this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)},n.prototype.once=function(t){return new Promise(function(e,i){this._listeners[t]||(this._listeners[t]=[]);const r=this._listeners[t];r.push(function(t){r.splice(r.indexOf(this),1),e(t)})}.bind(this))},n.prototype._onMessage=function(t){let e=t.origin;if("/"!==e[e.length-1]&&(e=t.origin+"/"),"*"!==this._targetOrigin&&e!==this._targetOrigin)return;if(t.source!==this._targetWindow)return;if(!t.data.rpcCall)return;const i=new r(t.data.rpcCall.id,t.data.rpcCall.methodName,t.data.rpcCall.args),n=this._listeners[t.data.rpcCall.methodName];if(n)for(let t=0,e=n.length;t<e;t++)n[t](i);this._calls[t.data.rpcCall.id]&&(this._calls[t.data.rpcCall.id].resolve(new class{constructor(t){this.event=t}get value(){return this.event.data.rpcCall.value}}(t)),delete this._calls[t.data.rpcCall.id])};class s{constructor(t){t=t||{},this._widgetUrl=t.widgetUrl||"http://localhost:4200/",this._widgetLocation=t.widgetLocation||"auth/widget","/"!==this._widgetUrl[this._widgetUrl.length-1]&&(this._widgetUrl+="/")}get widgetUrl(){return this._widgetUrl}get widgetLocation(){return this._widgetLocation}}i.d(e,"UserPermissions",function(){return a}),i.d(e,"Widget",function(){return o});const a={EMAIL:"email"};class o{constructor(t){if(this._settings=new s(t),this._widgetIframe=null,this._widgetRpc=null,this._baseNodeApi=null,this._verificationMessage=t.verificationMessage,this._buttonStyle=t.buttonStyle,!this._verificationMessage||this._verificationMessage.length<10)throw new Error("Verification message length is 10 characters minimum")}insertLoginButton(t){const e=document.createElement("iframe");e.frameBorder="0",e.width="300",e.height="48",e.src=this._settings.widgetUrl+this._settings.widgetLocation,e.sandbox="allow-scripts allow-popups allow-same-origin allow-forms allow-modals",document.querySelector(t).appendChild(e),this._widgetIframe=e,this._widgetRpc=new n(this._widgetIframe.contentWindow,this._settings.widgetUrl),this._widgetRpc.once("RPC.handshake").then(t=>{t.respond(this._widgetIframe.contentWindow,this._settings.widgetUrl,{verificationMessage:this._verificationMessage,buttonStyle:this._buttonStyle}),this._baseNodeApi=new l(this._widgetRpc)})}waitForLogin(){return console.warning('"waitForLogin" is deprecated, use "listenForLogin"'),this._widgetRpc.once("SDK.onLogin").then(function(t){return t.args[0]}.bind(this))}waitForLogout(){return console.warning('"waitForLogout" is deprecated, use "listenForLogout"'),this._widgetRpc.once("SDK.onLogout").then(function(t){return null}.bind(this))}listenForLogin(t){this._widgetRpc.listen("SDK.onLogin",function(e){const i=e.args[0];t(i),e.respond(this._widgetIframe.contentWindow,this._settings.widgetUrl,null)}.bind(this))}listenForLogout(t){this._widgetRpc.listen("SDK.onLogout",function(e){t(),e.respond(this._widgetIframe.contentWindow,this._settings.widgetUrl,null)}.bind(this))}requestPermissions(t){return this._widgetRpc.call("SDK.requestPermissions",[t]).then(function(t){return t.value})}openDashboard(){return this._widgetRpc.call("SDK.openDashboard",[])}getAllOffers(){return this._baseNodeApi.getAllOffers()}deleteAccount(){return this._baseNodeApi.deleteAccount()}logout(){return this._baseNodeApi.logout()}getData(){return this._baseNodeApi.getData()}updateData(t){return this._baseNodeApi.updateData(t)}addWealthValidator(t){return this._baseNodeApi.addWealthValidator(t)}createWalletsRecords(t,e){return this._baseNodeApi.createWalletsRecords(t,e)}refreshWealthPtr(){return this._baseNodeApi.refreshWealthPtr()}getRequests(t,e){return this._baseNodeApi.getRequests(t,e)}getAuthorizedData(t,e){return this._baseNodeApi.getAuthorizedData(t,e)}}class l{constructor(t){this._widgetRpc=t}getAllOffers(){return this._widgetRpc.call("offerManager.getAllOffers",[]).then(t=>t.value)}deleteAccount(){return this._widgetRpc.call("accountManager.unsubscribe",[]).then(t=>t.value)}logout(){return this._widgetRpc.call("logout",[])}getData(){return this._widgetRpc.call("profileManager.getData",[]).then(t=>t.value)}updateData(t){return this._widgetRpc.call("profileManager.updateData",[t]).then(t=>t.value)}addWealthValidator(t){return this._widgetRpc.call("walletManager.addWealthValidator",[t]).then(t=>t.value)}createWalletsRecords(t,e){return this._widgetRpc.call("walletManager.createWalletsRecords",[t,e]).then(t=>t.value)}refreshWealthPtr(){return this._widgetRpc.call("walletManager.refreshWealthPtr",[]).then(t=>{const e=t.value;if("string"==typeof e&&"validator did not verify anything yet"===e)throw new Error("validator did not verify anything yet");return e})}getRequests(t,e){return this._widgetRpc.call("dataRequestManager.getRequests",[t,e]).then(t=>t.value)}getAuthorizedData(t,e){return this._widgetRpc.call("profileManager.getAuthorizedData",[t,e]).then(t=>t.value)}}}])});