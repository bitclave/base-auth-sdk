!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("BASEAuthSDK",[],t):"object"==typeof exports?exports.BASEAuthSDK=t():e.BASEAuthSDK=t()}(window,function(){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";function s(e,t,i,s){this.id=e,this.methodName=t,this.args=i,this.resolve=s}i.r(t),s.prototype.send=function(e,t){e.postMessage({rpcCall:{id:this.id,methodName:this.methodName,args:this.args}},t)},s.prototype.respond=function(e,t,i){e.postMessage({rpcCall:{id:this.id,methodName:this.methodName,args:this.args,value:i}},t)};function r(e,t){this._targetWindow=e,this._targetOrigin=t,this._calls={},this._listeners={},this._currentCallId=1,"*"!==this._targetOrigin&&"/"!==this._targetOrigin[this._targetOrigin.length-1]&&(this._targetOrigin+="/"),window.addEventListener("message",this._onMessage.bind(this))}r.prototype.call=function(e,t){return new Promise(function(i,r){const n=this._currentCallId++;this._calls[n]=new s(n,e,t,i),this._calls[n].send(this._targetWindow,this._targetOrigin)}.bind(this))},r.prototype.listen=function(e,t){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)},r.prototype.once=function(e){return new Promise(function(t,i){this._listeners[e]||(this._listeners[e]=[]);const s=this._listeners[e];s.push(function(e){s.splice(s.indexOf(this),1),t(e)})}.bind(this))},r.prototype._onMessage=function(e){let t=e.origin;if("/"!==t[t.length-1]&&(t=e.origin+"/"),"*"!==this._targetOrigin&&t!==this._targetOrigin)return;if(e.source!==this._targetWindow)return;if(!e.data.rpcCall)return;const i=new s(e.data.rpcCall.id,e.data.rpcCall.methodName,e.data.rpcCall.args),r=this._listeners[e.data.rpcCall.methodName];if(r)for(let e=0,t=r.length;e<t;e++)r[e](i);this._calls[e.data.rpcCall.id]&&(this._calls[e.data.rpcCall.id].resolve(new class{constructor(e){this.event=e}get value(){return this.event.data.rpcCall.value}}(e)),delete this._calls[e.data.rpcCall.id])};class n{constructor(e){e=e||{},this._widgetUrl=e.widgetUrl||"http://localhost:4200/",this._widgetLocation=e.widgetLocation||"auth/widget","/"!==this._widgetUrl[this._widgetUrl.length-1]&&(this._widgetUrl+="/")}get widgetUrl(){return this._widgetUrl}get widgetLocation(){return this._widgetLocation}}i.d(t,"UserPermissions",function(){return a}),i.d(t,"Widget",function(){return o});const a={EMAIL:"email"};class o{constructor(e){if(this._settings=new n(e),this._widgetIframe=null,this._widgetRpc=null,this._baseNodeApi=null,this._verificationMessage=e.verificationMessage,this._buttonStyle=e.buttonStyle,!this._verificationMessage||this._verificationMessage.length<10)throw new Error("Verification message length is 10 characters minimum")}insertLoginButton(e){const t=document.createElement("iframe");t.frameBorder="0",t.width="300",t.height="48",t.src=this._settings.widgetUrl+this._settings.widgetLocation,t.sandbox="allow-scripts allow-popups allow-same-origin allow-forms allow-modals",document.querySelector(e).appendChild(t),this._widgetIframe=t,this._widgetRpc=new r(this._widgetIframe.contentWindow,this._settings.widgetUrl),this._widgetRpc.once("RPC.handshake").then(e=>{e.respond(this._widgetIframe.contentWindow,this._settings.widgetUrl,{verificationMessage:this._verificationMessage,buttonStyle:this._buttonStyle}),this._baseNodeApi=new l(this._widgetRpc)})}waitForLogin(){return console.warning('"waitForLogin" is deprecated, use "listenForLogin"'),this._widgetRpc.once("SDK.onLogin").then(function(e){return e.args[0]}.bind(this))}waitForLogout(){return console.warning('"waitForLogout" is deprecated, use "listenForLogout"'),this._widgetRpc.once("SDK.onLogout").then(function(e){return null}.bind(this))}listenForLogin(e){this._widgetRpc.listen("SDK.onLogin",function(t){const i=t.args[0];e(i),t.respond(this._widgetIframe.contentWindow,this._settings.widgetUrl,null)}.bind(this))}listenForLogout(e){this._widgetRpc.listen("SDK.onLogout",function(t){e(),t.respond(this._widgetIframe.contentWindow,this._settings.widgetUrl,null)}.bind(this))}requestPermissions(e){return this._widgetRpc.call("SDK.requestPermissions",[e]).then(function(e){return e.value})}openDashboard(){return this._widgetRpc.call("SDK.openDashboard",[])}getAllOffers(){return this._baseNodeApi.getAllOffers()}getMyOffers(e){return this._baseNodeApi.getMyOffers(e)}saveOffer(e){return this._baseNodeApi.saveOffer(e)}deleteOffer(e){return this._baseNodeApi.deleteOffer(e)}createRequest(e){return this._baseNodeApi.createRequest(e)}getMyRequests(e){return this._baseNodeApi.getMyRequests(e)}getAllRequests(){return this._baseNodeApi.getAllRequests()}deleteRequest(e){return this._baseNodeApi.deleteRequest(e)}getData(){return this._baseNodeApi.getData()}updateData(e){return this._baseNodeApi.updateData(e)}}class l{constructor(e){this._widgetRpc=e}getAllOffers(){return this._widgetRpc.call("offerManager.getAllOffers",[]).then(e=>e.value)}getMyOffers(e){return this._widgetRpc.call("offerManager.getOfferById",[e]).then(e=>e.value)}saveOffer(e){return this._widgetRpc.call("offerManager.saveOffer",[e]).then(e=>e.value)}deleteOffer(e){return this._widgetRpc.call("offerManager.deleteOffer",[e]).then(e=>e.value)}createRequest(e){return this._widgetRpc.call("searchManager.createRequest",[e]).then(e=>e.value)}getMyRequests(e){return this._widgetRpc.call("searchManager.getMyRequests",[e]).then(e=>e.value)}getAllRequests(){return this._widgetRpc.call("searchManager.getAllRequests",[]).then(e=>e.value)}deleteRequest(e){return this._widgetRpc.call("searchManager.deleteRequest",[e]).then(e=>e.value)}getData(){return this._widgetRpc.call("profileManager.getData",[]).then(e=>e.value)}updateData(e){return this._widgetRpc.call("profileManager.updateData",[e]).then(e=>e.value)}}}])});